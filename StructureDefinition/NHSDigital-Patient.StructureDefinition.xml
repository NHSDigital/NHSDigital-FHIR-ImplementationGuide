<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="7c42ccf1-3e8f-446c-8f7f-d703281a07d5" />
  <url value="https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient" />
  <name value="NHSDigitalPatient" />
  <status value="draft" />
  <description value="### identifier&#xD;&#xA;&#xD;&#xA;At least one patient identifier, **MUST** be provided. Where a traced NHS number is available for a patient this MUST be included. &#xD;&#xA;&#xD;&#xA;Local identiers such as MRN **MUST** include a *system* which identifies NHS provider/assigning authority." />
  <fhirVersion value="4.0.1" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Patient" />
  <baseDefinition value="https://fhir.hl7.org.uk/StructureDefinition/UKCore-Patient" />
  <derivation value="constraint" />
  <differential>
    <element id="Patient">
      <path value="Patient" />
      <constraint>
        <key value="patient-nhs" />
        <severity value="error" />
        <human value="Supplied NHS Number is outside the English and Welsh NHS Number range or length of the number is wrong." />
        <expression value="identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists().not() or (identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists()  and identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').value.matches('^([456789]{1}[0-9]{9})$'))" />
        <source value="https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient" />
      </constraint>
    </element>
    <element id="Patient.identifier">
      <path value="Patient.identifier" />
      <definition value="At least one patient identifier, common to both sender and receiver. Where a traced NHS number is available for a patient this MUST be included in the list." />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.identifier:nhsNumber">
      <path value="Patient.identifier" />
      <sliceName value="nhsNumber" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.identifier:nhsNumber.system">
      <path value="Patient.identifier.system" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.name">
      <path value="Patient.name" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.name.use">
      <path value="Patient.name.use" />
      <mapping>
        <identity value="MiM" />
        <map value="https://fhir.nhs.uk/ConceptMap/fhir-nameuse-to-v3-npfit-nameuse" />
      </mapping>
    </element>
    <element id="Patient.name.family">
      <path value="Patient.name.family" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.name.given">
      <path value="Patient.name.given" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.telecom">
      <path value="Patient.telecom" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.gender">
      <path value="Patient.gender" />
      <min value="1" />
      <mustSupport value="false" />
    </element>
    <element id="Patient.birthDate">
      <path value="Patient.birthDate" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.address">
      <path value="Patient.address" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Patient.address.extension">
      <path value="Patient.address.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="0" />
    </element>
    <element id="Patient.address.extension:addressKey">
      <path value="Patient.address.extension" />
      <sliceName value="addressKey" />
      <min value="0" />
      <max value="1" />
    </element>
    <element id="Patient.contact">
      <path value="Patient.contact" />
      <mustSupport value="false" />
    </element>
    <element id="Patient.generalPractitioner">
      <path value="Patient.generalPractitioner" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="identifier.system" />
        </discriminator>
        <rules value="openAtEnd" />
      </slicing>
      <requirements value="GP Surgery SHOULD be provided. It is recommended the patients GP Surgery is the first item in the array and branch surgery is second. It is also suggested type and display (name of practice) is also included." />
      <min value="1" />
      <max value="1" />
      <constraint>
        <key value="nhsd-5" />
        <severity value="warning" />
        <human value="generalPractitioner - a display name should be provided" />
        <expression value="(display.exists())" />
        <source value="https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient" />
      </constraint>
      <mustSupport value="true" />
    </element>
    <element id="Patient.generalPractitioner.identifier">
      <path value="Patient.generalPractitioner.identifier" />
      <min value="1" />
    </element>
    <element id="Patient.generalPractitioner.identifier.system">
      <path value="Patient.generalPractitioner.identifier.system" />
      <min value="1" />
    </element>
    <element id="Patient.generalPractitioner.identifier.value">
      <path value="Patient.generalPractitioner.identifier.value" />
      <min value="1" />
    </element>
    <element id="Patient.generalPractitioner:registeredGPPractice">
      <path value="Patient.generalPractitioner" />
      <sliceName value="registeredGPPractice" />
      <definition value="Patient's registered GP Practice. Use V81998 for no registered practice and V81999 for not known as per NHS Data Dictionary guidelines." />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="Patient.generalPractitioner:registeredGPPractice.identifier.system">
      <path value="Patient.generalPractitioner.identifier.system" />
      <fixedUri value="https://fhir.nhs.uk/Id/ods-organization-code" />
    </element>
    <element id="Patient.managingOrganization.identifier">
      <path value="Patient.managingOrganization.identifier" />
      <min value="1" />
    </element>
    <element id="Patient.managingOrganization.identifier.system">
      <path value="Patient.managingOrganization.identifier.system" />
      <fixedUri value="https://fhir.nhs.uk/Id/ods-organization-code" />
    </element>
  </differential>
</StructureDefinition>