{
  "resourceType": "StructureDefinition",
  "id": "790504c4-6314-4c50-a3e8-909ee027e020",
  "url": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-Task-EPS",
  "name": "NHSDigitalTaskEPS",
  "status": "draft",
  "purpose": "Constraint profile for Electronic Prescription System",
  "fhirVersion": "4.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "Task",
  "baseDefinition": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-Task",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Task.identifier",
        "path": "Task.identifier",
        "min": 1
      },
      {
        "id": "Task.identifier.system",
        "path": "Task.identifier.system",
        "min": 1
      },
      {
        "id": "Task.identifier.value",
        "path": "Task.identifier.value",
        "min": 1
      },
      {
        "id": "Task.groupIdentifier.system",
        "path": "Task.groupIdentifier.system",
        "min": 1
      },
      {
        "id": "Task.groupIdentifier.value",
        "path": "Task.groupIdentifier.value",
        "min": 1
      },
      {
        "id": "Task.statusReason",
        "path": "Task.statusReason",
        "mustSupport": true
      },
      {
        "id": "Task.statusReason.coding",
        "path": "Task.statusReason.coding",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "system"
            }
          ],
          "rules": "open"
        },
        "min": 1
      },
      {
        "id": "Task.statusReason.coding:withdrawReason",
        "path": "Task.statusReason.coding",
        "sliceName": "withdrawReason",
        "max": "1"
      },
      {
        "id": "Task.statusReason.coding:withdrawReason.system",
        "path": "Task.statusReason.coding.system",
        "fixedUri": "https://fhir.nhs.uk/CodeSystem/EPS-task-dispense-withdraw-reason"
      },
      {
        "id": "Task.statusReason.coding:dispenseReturn",
        "path": "Task.statusReason.coding",
        "sliceName": "dispenseReturn",
        "max": "1"
      },
      {
        "id": "Task.statusReason.coding:dispenseReturn.system",
        "path": "Task.statusReason.coding.system",
        "fixedUri": "https://fhir.nhs.uk/CodeSystem/EPS-task-dispense-return-status-reason"
      },
      {
        "id": "Task.statusReason.coding:medicationRequestStatusReason",
        "path": "Task.statusReason.coding",
        "sliceName": "medicationRequestStatusReason",
        "max": "1"
      },
      {
        "id": "Task.statusReason.coding:medicationRequestStatusReason.system",
        "path": "Task.statusReason.coding.system",
        "fixedUri": "https://fhir.nhs.uk/CodeSystem/medicationrequest-status-reason"
      },
      {
        "id": "Task.businessStatus",
        "path": "Task.businessStatus",
        "binding": {
          "strength": "required",
          "valueSet": "https://fhir.nhs.uk/ValueSet/DM-task-business-status"
        }
      },
      {
        "id": "Task.businessStatus.coding",
        "path": "Task.businessStatus.coding",
        "min": 1
      },
      {
        "id": "Task.businessStatus.coding.system",
        "path": "Task.businessStatus.coding.system",
        "min": 1
      },
      {
        "id": "Task.businessStatus.coding.code",
        "path": "Task.businessStatus.coding.code",
        "min": 1
      },
      {
        "id": "Task.businessStatus.coding.display",
        "path": "Task.businessStatus.coding.display",
        "min": 1
      },
      {
        "id": "Task.code.coding",
        "path": "Task.code.coding",
        "min": 1
      },
      {
        "id": "Task.code.coding.system",
        "path": "Task.code.coding.system",
        "min": 1
      },
      {
        "id": "Task.code.coding.code",
        "path": "Task.code.coding.code",
        "min": 1
      },
      {
        "id": "Task.code.coding.display",
        "path": "Task.code.coding.display",
        "min": 1
      },
      {
        "id": "Task.focus",
        "path": "Task.focus",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.nhs.uk/StructureDefinition/NHSDigital-Bundle-FHIRMessage"
            ]
          }
        ]
      },
      {
        "id": "Task.focus.identifier.system",
        "path": "Task.focus.identifier.system",
        "min": 1
      },
      {
        "id": "Task.focus.identifier.value",
        "path": "Task.focus.identifier.value",
        "min": 1
      },
      {
        "id": "Task.authoredOn",
        "path": "Task.authoredOn",
        "min": 1
      },
      {
        "id": "Task.requester",
        "path": "Task.requester",
        "definition": "Who is created the Request or the Event. In NHSDigital API's this **SHOULD** always be a PractitionerRole role reference.\r\n\r\n```json\r\n \"requester\": {\r\n        \"reference\": \"#requester\"\r\n    },\r\n```\r\n\r\nThis will reference a `contained` PractitionerRole (note: this resource only contains limited user metadata such as ODS Code, professional code and SDS User Profile Id). This resource should not hold data which is held in SDS, only enough information to identify the SDS Entry,\r\n\r\n```json\r\n{\r\n    \"resourceType\": \"Task\",\r\n    \"id\": \"bd1ca5c4-ff49-4f2a-9db4-f5dda0112084\",\r\n    \"meta\": {\r\n        \"lastUpdated\": \"2016-07-11T11:07:22+00:00\"\r\n    },\r\n    \"contained\": [\r\n       {\r\n            \"resourceType\": \"PractitionerRole\",\r\n            \"id\": \"requester\",\r\n            \"identifier\": [\r\n                {\r\n                    \"system\": \"https://fhir.nhs.uk/Id/sds-role-profile-id\",\r\n                    \"value\": \"641555508106\"\r\n                }\r\n            ],\r\n            \"code\": [\r\n                {\r\n                    \"coding\": [\r\n                        {\r\n                            \"system\": \"https://fhir.nhs.uk/CodeSystem/NHSDigital-SDS-JobRoleCode\",\r\n                            \"code\": \"S0030:G0100:R0620\"\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n            \"practitioner\": {\r\n                   \"identifier\": {\r\n                      \"system\": \"https://fhir.nhs.uk/Id/sds-user-id\",\r\n                       \"value\": \"7654321\"\r\n                    },\r\n                   \"display\": \"Mr Peter Potion\"\r\n            },\r\n            \"organization\": {\r\n                \"identifier\": {\r\n                    \"system\": \"https://fhir.nhs.uk/Id/ods-organization-code\",\r\n                    \"value\": \"VNE51\"\r\n                },\r\n                \"display\": \"SIMPLE PHARMACY\"\r\n            },\r\n            \"telecom\": [\r\n                {\r\n                    \"system\": \"phone\",\r\n                    \"use\": \"work\",\r\n                    \"value\": \"01234567890\"\r\n                }\r\n            ]\r\n        }\r\n    ],\r\n```",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.nhs.uk/StructureDefinition/NHSDigital-PractitionerRole-SDS"
            ]
          }
        ]
      },
      {
        "id": "Task.requester.reference",
        "path": "Task.requester.reference",
        "min": 1
      },
      {
        "id": "Task.owner",
        "path": "Task.owner",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.nhs.uk/StructureDefinition/NHSDigital-Organization"
            ]
          }
        ]
      },
      {
        "id": "Task.owner.identifier",
        "path": "Task.owner.identifier",
        "min": 1
      },
      {
        "id": "Task.input.extension",
        "path": "Task.input.extension",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "url"
            }
          ],
          "rules": "open"
        },
        "min": 0
      },
      {
        "id": "Task.input.extension:dispensingInformation",
        "path": "Task.input.extension",
        "sliceName": "dispensingInformation",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://fhir.nhs.uk/StructureDefinition/Extension-EPS-DispensingInformation"
            ]
          }
        ]
      },
      {
        "id": "Task.output",
        "path": "Task.output",
        "mustSupport": true
      },
      {
        "id": "Task.output.extension",
        "path": "Task.output.extension",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "url"
            }
          ],
          "rules": "open"
        },
        "min": 0
      },
      {
        "id": "Task.output.extension:dispensingReleaseInformation",
        "path": "Task.output.extension",
        "sliceName": "dispensingReleaseInformation",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "https://fhir.nhs.uk/StructureDefinition/Extension-EPS-DispensingReleaseInformation"
            ]
          }
        ]
      }
    ]
  }
}